(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{155:function(t,i,e){},157:function(t,i,e){},158:function(t,i,e){},170:function(t,i){!function(t){var i,e='<svg><symbol id="icon-loading2" viewBox="0 0 1024 1024"><path d="M276 473c-93.888 0-170-75.888-170-169.5S182.112 134 276 134s170 75.888 170 169.5S369.888 473 276 473z m549-49c-49.153 0-89-39.623-89-88.5s39.847-88.5 89-88.5 89 39.623 89 88.5-39.847 88.5-89 88.5zM495.5 907C422.875 907 364 848.125 364 775.5S422.875 644 495.5 644 627 702.875 627 775.5 568.125 907 495.5 907z"  ></path></symbol><symbol id="icon-loading" viewBox="0 0 1024 1024"><path d="M755.0464 862.72a34.7648 34.7648 0 0 1-12.8512 48.0256 34.6624 34.6624 0 0 1-47.7696-12.8512 34.7648 34.7648 0 0 1 12.288-48.0256 35.4816 35.4816 0 0 1 48.3328 12.8z m-207.3088 74.9056c0 19.1488-15.8208 35.1744-35.6864 35.1744a35.2768 35.2768 0 0 1-35.1744-35.1744v-24.6272a35.4816 35.4816 0 0 1 70.8608 0v24.6272z m-216.9856-39.7312a35.072 35.072 0 0 1-48.3328 13.0048 34.8672 34.8672 0 0 1-13.0048-48.2816l26.112-45.7728a36.1472 36.1472 0 0 1 48.7936-13.056 35.328 35.328 0 0 1 12.5952 48.3328l-26.1632 45.7728zM162.304 755.712a35.5328 35.5328 0 0 1-48.3328-13.056 35.1744 35.1744 0 0 1 12.5952-48.2816l70.3488-40.7552a35.584 35.584 0 0 1 48.2816 13.0048 35.84 35.84 0 0 1-13.056 48.3328l-69.888 40.7552zM87.3984 547.84a35.1232 35.1232 0 0 1-35.1744-35.1744c0-19.6096 15.5648-35.4304 35.1744-35.4304h109.568c19.5584 0 35.1232 15.872 35.1232 35.1744a35.1744 35.1744 0 0 1-35.1744 35.4304h-109.568z m39.2192-217.3952a34.4576 34.4576 0 0 1-12.5952-48.0256 35.0208 35.0208 0 0 1 48.2816-13.0048l119.0912 69.12a35.2256 35.2256 0 0 1 13.056 47.7696 35.4816 35.4816 0 0 1-48.2304 13.056L126.6688 330.4448z m142.7456-168.3456l82.944 143.9744a35.2256 35.2256 0 1 0 61.0816-35.4304L330.0352 126.976a35.1232 35.1232 0 0 0-60.7232 35.1744z m207.5648-74.3936a35.84 35.84 0 0 1 35.1744-35.4304c19.6096 0 35.6864 15.9232 35.6864 35.4304v165.888a35.84 35.84 0 0 1-35.6864 35.6864 35.328 35.328 0 0 1-35.1744-35.7376V87.7056z m217.0368 39.2192a35.4304 35.4304 0 0 1 48.2816-13.056 34.816 34.816 0 0 1 13.056 48.3328L672.2048 306.176a35.4304 35.4304 0 0 1-48.2816 13.056 35.9424 35.9424 0 0 1-12.8512-48.5888l82.944-143.7184z m168.8576 142.4896l-144.128 83.0976a35.4816 35.4816 0 0 0-13.056 48.2816 36.2496 36.2496 0 0 0 48.2816 12.8512l144.2816-83.0976a34.9184 34.9184 0 0 0 12.5952-48.0256 34.6624 34.6624 0 0 0-47.9744-13.1072z m74.1376 207.872c19.7632 0 35.4304 15.7696 35.1744 35.3792a34.9184 34.9184 0 0 1-35.1744 35.1744h-166.0416a35.5328 35.5328 0 0 1-35.2256-35.4304c0-19.3536 16.0768-35.1744 35.2256-35.1744h166.0416z"  ></path></symbol><symbol id="icon-delete" viewBox="0 0 1024 1024"><path d="M139.43164062 512C139.43164062 305.94042969 306.3359375 139.03613281 512 139.03613281s372.56835938 166.90429688 372.56835938 372.56835938V512A372.17285156 372.17285156 0 0 1 512 884.56835938C305.94042969 884.56835938 139.43164062 717.6640625 139.43164062 512z m397.48535157 0l130.12207031-130.12207031a16.93492536 16.93492536 0 0 0 0-24.12597657l-0.79101562-0.79101562a16.93492536 16.93492536 0 0 0-24.12597657 0L512 487.47851562l-130.12207031-130.51757812a16.93492536 16.93492536 0 0 0-24.12597657 0l-0.79101562 0.79101563a16.93492536 16.93492536 0 0 0 0 24.12597656l130.12207031 130.51757812-130.12207031 130.12207032a16.93492536 16.93492536 0 0 0 0 24.12597656l0.79101563 0.79101562a16.93492536 16.93492536 0 0 0 24.12597656 0L512 537.3125l130.12207031 130.12207031a16.93492536 16.93492536 0 0 0 24.12597657 0l0.79101562-0.79101562a16.93492536 16.93492536 0 0 0 0-24.12597656L536.91699219 512z"  ></path></symbol></svg>';if((i=document.getElementsByTagName("script"))[i.length-1].getAttribute("data-injectcss")&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(i){console&&console.log(i)}}!function(i){if(document.addEventListener)if(~["complete","loaded","interactive"].indexOf(document.readyState))setTimeout(i,0);else{document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,!1),i()},!1)}else document.attachEvent&&(e=i,n=t.document,s=!1,o=function(){s||(s=!0,e())},(a=function(){try{n.documentElement.doScroll("left")}catch(t){return void setTimeout(a,50)}o()})(),n.onreadystatechange=function(){"complete"==n.readyState&&(n.onreadystatechange=null,o())});var e,n,s,o,a}(function(){var t,i;(t=document.createElement("div")).innerHTML=e,e=null,(i=t.getElementsByTagName("svg")[0])&&(i.setAttribute("aria-hidden","true"),i.style.position="absolute",i.style.width=0,i.style.height=0,i.style.overflow="hidden",function(t,i){i.firstChild?function(t,i){i.parentNode.insertBefore(t,i)}(t,i.firstChild):i.appendChild(t)}(i,document.body))})}(window)},171:function(t,i,e){"use strict";var n=e(155);e.n(n).a},196:function(t,i,e){"use strict";var n=e(157);e.n(n).a},197:function(t,i,e){"use strict";var n=e(158);e.n(n).a},200:function(t,i,e){"use strict";e.r(i);var n=e(198),s=e(8),o=(e(48),e(165),e(167),e(170),{name:"g-icon",props:["iconname"]}),a=(e(171),e(0)),c=Object(a.a)(o,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("svg",{staticClass:"g-icon",on:{click:function(i){return t.$emit("click",i)}}},[e("use",{attrs:{"xlink:href":"#icon-"+t.iconname}})])},[],!1,null,"290501f0",null).exports,l=(e(14),e(172),e(174)),h=e(175).default,r=function(t){if(this.renderTo=document.body,this.canvas=document.createElement("canvas"),this.output=t.output,this.width=t.width,this.height=t.height,this.canvas.width=t.width*this.output,this.canvas.height=t.height*this.output,this.circle=t.circle,t.width!==t.height&&t.circle)throw"can't set circle to true when width is not equal to height";this.ctx=this.canvas.getContext("2d"),this.croppingBox=document.createElement("div"),this.croppingBox.style.visibility="hidden",this.croppingBox.className=t.className||"",this.cover=document.createElement("canvas"),this.type=t.type||"png",this.cover.width=window.innerWidth,this.cover.height=window.innerHeight,this.cover_ctx=this.cover.getContext("2d"),this.img=document.createElement("img"),"http"===t.image_src.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.cancel=t.cancel,this.ok=t.ok,this.ok_text=t.ok_text||"ok",this.cancel_text=t.cancel_text||"cancel",this.croppingBox.appendChild(this.img),this.croppingBox.appendChild(this.cover),this.renderTo.appendChild(this.croppingBox),this.img.onload=this.init.bind(this),this.img.src=t.image_src,this.cancel_btn=document.createElement("a"),this.cancel_btn.innerHTML=this.cancel_text,this.ok_btn=document.createElement("a"),this.ok_btn.innerHTML=this.ok_text,this.croppingBox.appendChild(this.ok_btn),this.croppingBox.appendChild(this.cancel_btn),this.alloyFingerList=[]};r.prototype={init:function(){this.img_width=this.img.naturalWidth,this.img_height=this.img.naturalHeight,h(this.img,!0);var t=window.innerWidth/this.img_width;window.innerHeight,this.img_height;this.initScale=t,this.originScale=t,this.img.scaleX=this.img.scaleY=t,this.first=1;var i=this;this.alloyFingerList.push(new l(this.croppingBox,{multipointStart:function(t){var e=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2,s=i.img.getBoundingClientRect(),o=e-(s.left+s.width/2),a=n-(s.top+s.height/2),c=i.img.originX,l=i.img.originY;i.img.originX=o/i.img.scaleX,i.img.originY=a/i.img.scaleY,i.img.translateX+=o-c*i.img.scaleX,i.img.translateY+=a-l*i.img.scaleX,1==i.first&&(i.img.scaleX=i.img.scaleY=1.1*i.initScale,++i.first),i.initScale=i.img.scaleX},pinch:function(t){var e=i.img.getBoundingClientRect(),n=(document.documentElement.clientHeight-i.height)/2,s=t.zoom,o=(e.width*s-e.width)/2,a=(e.height-e.height*s)/2;i.initScale*s<=1.6&&i.initScale*s>=i.originScale&&o>=e.left&&-o<=e.right-i.width&&a<=n-e.top&&a<=e.bottom-n-i.height&&(i.img.scaleX=i.img.scaleY=i.initScale*s)},pressMove:function(t){var e=i.img.getBoundingClientRect(),n=(document.documentElement.clientHeight-i.height)/2;n-e.top-t.deltaY>=0&&e.bottom+t.deltaY-n>=i.height&&(i.img.translateY+=t.deltaY);var s=(document.documentElement.clientWidth-i.width)/2;e.left+t.deltaX<=s&&e.right+t.deltaX-s>=i.width&&(i.img.translateX+=t.deltaX),t.preventDefault()}})),this.alloyFingerList.push(new l(this.cancel_btn,{touchStart:function(){i.cancel_btn.style.backgroundColor="#ffffff",i.cancel_btn.style.color="#3B4152"},tap:this._cancel.bind(this)})),this.alloyFingerList.push(new l(this.ok_btn,{touchStart:function(){i.ok_btn.style.backgroundColor="#2bcafd",i.ok_btn.style.color="#ffffff"},tap:this._ok.bind(this)})),this.alloyFingerList.push(new l(document,{touchEnd:function(){i.cancel_btn.style.backgroundColor="#ffffff",i.ok_btn.style.backgroundColor="#2bcafd"}})),this.renderCover(),this.setStyle()},_cancel:function(){this._css(this.croppingBox,{display:"none"}),this.cancel()},_ok:function(){this.crop(),this._css(this.croppingBox,{display:"none"}),this.ok(this.canvas.toDataURL("image/"+this.type),this.canvas)},renderCover:function(){var t=this.cover_ctx,i=this.cover.width,e=this.cover.height,n=this.width,s=this.height;t.save(),t.fillStyle="black",t.globalAlpha=.7,t.fillRect(0,0,this.cover.width,this.cover.height),t.restore(),t.save(),t.globalCompositeOperation="destination-out",t.beginPath(),this.circle?t.arc(i/2,e/2,n/2-4,0,2*Math.PI,!1):t.rect(i/2-n/2,e/2-s/2,n,s),t.fill(),t.restore(),t.save(),t.beginPath(),t.strokeStyle="white",this.circle?t.arc(i/2,e/2,n/2-4,0,2*Math.PI,!1):t.rect(i/2-n/2,e/2-s/2,n,s),t.stroke()},setStyle:function(){this._css(this.cover,{position:"fixed",zIndex:"100",left:"0px",top:"0px"}),this._css(this.croppingBox,{color:"white",textAlign:"center",fontSize:"18px",textDecoration:"none",visibility:"visible"}),this._css(this.img,{position:"fixed",zIndex:"99",left:"50%",top:window.innerHeight/2+"px",marginLeft:this.img_width/-2+"px",marginTop:this.img_height/-2+"px"}),this._css(this.ok_btn,{position:"fixed",zIndex:"101",width:"100px",right:"50px",lineHeight:"40px",height:"40px",bottom:"20px",borderRadius:"2px",color:"#ffffff",backgroundColor:"#2bcafd"}),this._css(this.cancel_btn,{position:"fixed",zIndex:"101",width:"100px",height:"40px",lineHeight:"40px",left:"50px",bottom:"20px",borderRadius:"2px",color:"#3B4152",backgroundColor:"#ffffff"})},crop:function(){this.calculateRect(),this.ctx.drawImage(this.img,this.crop_rect[0],this.crop_rect[1],this.crop_rect[2],this.crop_rect[3],0,0,this.crop_rect[2]*this.img.scaleX,this.crop_rect[3]*this.img.scaleY)},calculateRect:function(){var t=this.img.getBoundingClientRect(),i=window.innerWidth/2-this.width/2,e=window.innerHeight/2-this.height/2,n=[i,e,this.width+i,this.height+e],s=[t.left,t.top,t.width+t.left,t.height+t.top],o=this.getOverlap.apply(this,n.concat(s)),a=(o[0]-s[0])/this.img.scaleX,c=(o[1]-s[1])/this.img.scaleY,l=o[2]/this.img.scaleX,h=o[3]/this.img.scaleY;a<0&&(a=0),c<0&&(c=0),a+l>this.img_width&&(l=this.img_width-a),c+h>this.img_height&&(h=this.img_height-c),this.crop_rect=[a,c,l,h]},getOverlap:function(t,i,e,n,s,o,a,c){if(e<s||n<o||t>a||i>c)return[0,0,0,0];var l=Math.max(t,s),h=Math.max(i,o);return[l,h,Math.min(e,a)-l,Math.min(n,c)-h]},_css:function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t.style[e]=i[e])},destroy:function(){for(var t in this.alloyFingerList.forEach(function(t){t.destroy()}),this.renderTo.removeChild(this.croppingBox),this)delete this[t]}};var d=r,u=e(176),p=e.n(u),g=e(177),f=e.n(g),m={name:"uploader",components:{GIcon:c},props:{imageCut:{type:Boolean,default:!0},action:{type:String,required:!0},name:{type:String,required:!0},method:{type:String,default:"POST"},parseResponse:{type:Function,required:!0},fileList:{type:Array,default:function(){return[]}},height:{type:[Number,String],default:80},width:{type:[Number,String],default:80}},methods:{onClickUpload:function(){var t=this,i=this.createInput();i.addEventListener("change",function(){t.imageCut?t.choosePhoto(i.files[0]):t.uploadFiles(void 0,i.files),i.remove()}),i.click()},createInput:function(){this.$refs.temp.innerHTML="";var t=document.createElement("input");return t.type="file",t.multiple=!this.imageCut,this.$refs.temp.appendChild(t),t},beforeUploadFile:function(t,i){var e=t.size,n=t.type;return this.$emit("addFile",{name:i,size:e,type:n,status:"uploading"}),!0},choosePhoto:function(t){var i=this,e=new FileReader;"undefined"==typeof FileReader?alert("浏览器不支持图片预览功能，请换浏览器重试"):(e.readAsDataURL(t),e.onload=function(){i.clipImg(e.result,t)})},clipImg:function(t,i){var e=this;new d({image_src:t,circle:!1,width:300,height:300,output:1,ok:function(t,n){console.log("ok"),e.uploadFiles(t,i)},cancel:function(){},ok_text:"确定",cancel_text:"取消"})},uploadFiles:function(t,i){var e=this;if(console.log(i),this.imageCut){var n=i.name,s=this.generateName(n);this.beforeUploadFile(i,s);var o={filename:s,file:t,time:new Date};this.ajax(o,s)}else Array.from(i).map(function(t){var n=t.name,s=e.generateName(n);e.beforeUploadFile(i,s),p()(t,{width:800,quality:.5}).then(function(t){console.log(t);var i={filename:s,file:t.base64,time:new Date};e.ajax(i,s)})})},afterUploadFiles:function(t,i){console.log(this.fileList);var e=this.fileList.filter(function(t){return t.name===i})[0],n=this.fileList.indexOf(e),o=JSON.parse(JSON.stringify(e));o.url=t,o.status="success";var a=Object(s.a)(this.fileList);a.splice(n,1,o),console.log("fileListCopy"),console.log(a),this.$emit("update:fileList",a)},generateName:function(t){for(;this.fileList.filter(function(i){return i.name===t}).length>0;){var i=t.lastIndexOf("."),e=t.substring(0,i),n=t.substring(i);t=e+"(1)"+n}return t},ajax:function(t,i){var e=this;f.a.post(this.action,Object(n.a)({},t)).then(function(t){var n=e.parseResponse(t.data.file);e.afterUploadFiles(n,i)}).catch(function(){e.uploadError(i)})},uploadError:function(t){var i=this.fileList.filter(function(i){return i.name===t})[0],e=JSON.parse(JSON.stringify(i));e.status="fail";var n=Object(s.a)(this.fileList),o=n.indexOf(i);n.splice(o,1,e),this.$emit("update:fileList",n)},onRemoveFile:function(t){var i=JSON.parse(JSON.stringify(this.fileList));i.filter(function(e,n){e.name===t.name&&i.splice(n,1)}),this.$emit("update:fileList",i)}}},v=(e(196),{name:"app",components:{GUploader:Object(a.a)(m,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"uploader"},[e("ol",{staticClass:"fileList"},[t._l(t.fileList,function(i){return e("li",{key:i.name},[e("div",{staticClass:"image-wrapper"},["uploading"===i.status?[e("g-icon",{staticClass:"spin icon-loading",attrs:{iconname:"loading2"}})]:i.url.indexOf("image")>=0?[e("img",{staticClass:"addFile",style:{width:t.width+"px",height:t.height+"px"},attrs:{src:i.url,alt:""}}),t._v(" "),e("div",{staticClass:"remove-wrapper"},[e("g-icon",{staticClass:"remove-icon",attrs:{iconname:"close"},on:{click:function(e){return t.onRemoveFile(i)}}})],1)]:[e("div",{staticClass:"defaultImage"})]],2)])}),t._v(" "),e("li",[e("div",{on:{click:t.onClickUpload}},[e("div",{staticClass:"addFile",style:{width:t.width+"px",height:t.height+"px"}},[e("div",{staticClass:"row"}),t._v(" "),e("div",{staticClass:"col"})])])])],2),t._v(" "),e("div",{ref:"temp",staticStyle:{width:"0",height:"0",overflow:"hidden"}})])},[],!1,null,"c95a5a16",null).exports},data:function(){return{fileList:[],fileList2:[],URL:"https://image-server-gulu.herokuapp.com/upload"}},methods:{parseResponse:function(t){return t},addFile:function(t){this.fileList.push(t)},addFile2:function(t){this.fileList2.push(t)}}}),_=(e(197),Object(a.a)(v,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticStyle:{"margin-top":"20px"}},[e("h4",[t._v(" 不可裁剪模式（可多文件上传）")]),t._v(" "),e("g-uploader",{attrs:{height:"80",width:"80",action:t.URL,imageCut:!1,name:"file",method:"POST",parseResponse:t.parseResponse,"file-list":t.fileList},on:{addFile:t.addFile,"update:fileList":function(i){t.fileList=i},"update:file-list":function(i){t.fileList=i}}}),t._v(" "),e("h4",[t._v(" 可裁剪模式(请在移动端尝试，否则会有bug)")]),t._v(" "),e("g-uploader",{attrs:{height:"80",width:"80",action:t.URL,imageCut:!0,name:"file",method:"POST",parseResponse:t.parseResponse,"file-list":t.fileList2},on:{addFile:t.addFile2,"update:fileList":function(i){t.fileList2=i},"update:file-list":function(i){t.fileList2=i}}})],1)},[],!1,null,null,null));i.default=_.exports}}]);